generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model ApplicationInfo {
  id        Int      @id @default(autoincrement())
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model SessionCounter {
  id        Int      @id @default(autoincrement())
  sessionId String   @unique
  visits    Int      @default(0)
  userId    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Project {
  id         String      @id @default(uuid())
  name       String
  description String?
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  conditions Condition[]
  discussions Discussion[]
  features   Feature[]
  keys       Key[]
  users      User[]      @relation("ProjectUsers")
  projectRequirements ProjectRequirement[]
}

model User {
  id        String    @id @default(uuid())
  email     String    @unique
  name      String?
  projects  Project[] @relation("ProjectUsers")
  hash      UserHash?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model UserHash {
  id     String @id @default(uuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  hash   String
}

model Key {
  id        String   @id @default(uuid())
  name      String
  projectId String
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  hash      KeyHash?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model KeyHash {
  id      String @id @default(uuid())
  keyId   String @unique
  key     Key    @relation(fields: [keyId], references: [id], onDelete: Cascade)
  hash    String
}

model Condition {
  id        String   @id @default(uuid())
  name      String
  message   String?
  projectId String
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum FeatureStatus {
  OPEN
  LOCKED
  CLOSED
}

enum RequirementStatus {
  OPEN
  CLOSED
}

model Feature {
  id           String        @id @default(uuid())
  name         String
  message      String?
  status       FeatureStatus @default(OPEN)
  projectId    String
  project      Project       @relation(fields: [projectId], references: [id], onDelete: Cascade)
  requirements Requirement[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}

model Requirement {
  id        String            @id @default(uuid())
  name      String
  status    RequirementStatus @default(OPEN)
  featureId String
  feature   Feature           @relation(fields: [featureId], references: [id], onDelete: Cascade)
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt
}

model ProjectRequirement {
  id        String   @id @default(uuid())
  name      String
  projectId String
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Discussion {
  id        String              @id @default(uuid())
  name      String
  projectId String
  project   Project             @relation(fields: [projectId], references: [id], onDelete: Cascade)
  messages  DiscussionMessage[]
  createdAt DateTime            @default(now())
  updatedAt DateTime            @updatedAt
}

model DiscussionMessage {
  id           String     @id @default(uuid())
  body         String
  authorName   String
  discussionId String
  discussion   Discussion @relation(fields: [discussionId], references: [id], onDelete: Cascade)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
}
